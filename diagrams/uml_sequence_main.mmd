sequenceDiagram
    %% Основний сценарій роботи програми (користувач -> SSA/ARIMA)

    participant User as Користувач
    participant CLI as main.py / CLI
    participant DS as TimeSeriesDataset
    participant DB as RocketLaunchDB
    participant Pipe as ForecastPipeline
    participant SSAa as SSAAnalyzer
    participant ARIMAa as ARIMAAnalyzer
    participant SSA as SSA (library)

    User->>CLI: запуск програми (python main.py ...)
    CLI->>CLI: parse_args()
    CLI->>CLI: створення папки results/<br/>відкриття output.txt для запису
    CLI->>CLI: перенаправлення stdout<br/>через клас Tee (дублювання виводу)

    alt Використати БД запусків (--use-db)
        CLI->>DB: RocketLaunchDB(db_path=None)<br/>(автоматично створює data/rockets.db)
        CLI->>DB: connect()
        CLI->>DB: create_tables()
        CLI->>DB: ensure_demo_data(force_reload=False)
        activate DB
        DB->>DB: load_from_csv("launches_2025__01-11.csv")<br/>(якщо файл існує)
        DB->>DB: load_from_csv("launches_2025-11.csv")<br/>(якщо файл існує)
        DB->>DB: insert_launch(launch, check_duplicates=True)<br/>(перевірка дублікатів)
        deactivate DB
        CLI->>DB: load_series(metric="count_per_month_2025")
        DB-->>CLI: np.ndarray (часовий ряд)
        CLI->>DS: TimeSeriesDataset(values, name="Кількість запусків...", source="SQLite БД")
    else CSV / тестові дані
        alt CSV (--data)
            CLI->>DS: TimeSeriesDataset.from_csv(path, column)
        else Тестові дані (погода)
            CLI->>DS: TimeSeriesDataset.from_weather_example(points, seed)
        end
    end

    CLI->>Pipe: ForecastPipeline(dataset, window_length,<br/> arima_order, forecast_steps, output_dir)

    CLI->>Pipe: run(show_plots=True, command_info=dict)

    activate Pipe
    Pipe->>SSAa: analyze()
    activate SSAa
    SSAa->>SSA: embed() / decompose() / reconstruct()
    SSA-->>SSAa: компоненти, внесок
    SSAa-->>Pipe: SSA результати
    deactivate SSAa

    Pipe->>ARIMAa: analyze()
    activate ARIMAa
    ARIMAa-->>Pipe: ARIMA результати
    deactivate ARIMAa

    Pipe->>Pipe: побудова графіків<br/>SSA / ARIMA / порівняння
    Pipe->>Pipe: збереження графіків:<br/>ssa_results.png<br/>arima_results.png<br/>comparison.png
    Pipe->>Pipe: збереження command.txt<br/>(інформація про команду)
    Pipe-->>CLI: результати та шляхи до зображень
    deactivate Pipe

    CLI->>CLI: finally блок:<br/>відновлення stdout<br/>закриття output.txt
    CLI-->>User: текстовий звіт + файли графіків<br/>+ output.txt + command.txt